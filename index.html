<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>SYSTEME COSTUME 17</title>
<style>
body{font-family:Arial;direction:rtl;background:#f4f4f4;margin:0;padding:0;}
.container{max-width:1100px;margin:auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center;margin-bottom:15px;}
form{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:flex-start;}
form input, form select{padding:7px;margin:0;width:auto;flex:1;}
button{padding:7px 12px;margin:5px;background:#3498db;color:#fff;border:none;cursor:pointer;border-radius:4px;}
button:hover{opacity:0.85;}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:14px;}
.available{background:#e8ffe8}
.unavailable{background:#ffd6d6}
.returned{background:#fce5d6 !important}
.stock-buttons{margin:15px 0;text-align:center;}
.stock-buttons button{width:auto;margin:3px;padding:5px 10px;}
#stockPages{display:none;}
.search-section{margin:10px 0;display:flex;gap:5px;align-items:center;}
.search-section input{flex:1;padding:6px;}
</style>
</head>
<body>

<div class="container" id="mainPage">

<h2>COSTUME17</h2>

<form>
<input id="fname" placeholder=" الاسم واللقب">
<input id="phone" placeholder="رقم الهاتف">
<input type="date" id="rentDate">
<input type="date" id="returnDate">

<select id="Couleur"></select>
<select id="pant"></select>
<select id="gilet"></select>
<select id="vest"></select>
<select id="shirt"></select>
<select id="belt"></select>
<select id="shoe"></select>
<select id="tie"></select>
<select id="bow"></select>
<select id="broche"></select>

<button type="button" onclick="addRental()">تأكيد التأجير</button>
</form>


<div class="stock-buttons">
<button onclick="window.location.href='couleurs.html'">مخزون الوان البدلات</button>
<button onclick="window.location.href='pants.html'">مخزون السراويل</button>
<button onclick="window.location.href='gilets.html'">مخزون الجيلي</button>
<button onclick="window.location.href='vests.html'">مخزون الفاست</button>
<button onclick="window.location.href='shirts.html'">مخزون القمصان</button>
<button onclick="window.location.href='belts.html'">مخزون الأحزمة</button>
<button onclick="window.location.href='shoes.html'">مخزون الأحذية</button>
<button onclick="window.location.href='ties.html'">مخزون ربطات العنق</button>
<button onclick="window.location.href='bows.html'">مخزون الفراشات</button>
<button onclick="window.location.href='broches.html'">مخزون البروش</button>
</div>

<table>
<thead>
<tr>
<th>الاسم واللقب</th>
<th>الهاتف</th>
 <th>اللون</th>
<th>السروال</th>
<th>الجيلي</th>
<th>الفاست</th>
<th>القميص</th>
<th>الحزام</th>
<th>الحذاء</th>
<th>الربطة</th>
<th>الفراشة</th>
<th>البروش</th>
<th>تاريخ الإرجاع</th>
<th>إرجاع</th>
<th>حذف</th>
</tr>
</thead>
<tbody id="rentalsBody"></tbody>
</table>

</div>

<!-- صفحة المخزون الخاصة -->
<div id="stockPages" class="container">
<h2>صفحة المخزون</h2>
<table>
<thead>
<tr><th>الاسم</th><th>المقاس</th><th>الحالة</th></tr>
</thead>
<tbody id="stockBody"></tbody>
</table>
<button onclick="hideStock()">رجوع للصفحة الرئيسية</button>
</div>

<script>
// ===== المؤجرين =====
let rentals = JSON.parse(localStorage.getItem("rentals")) || [];

// ===== التاريخ اليوم تلقائي =====
document.getElementById("rentDate").value = new Date().toISOString().split("T")[0];

// ===== إنشاء المقاسات =====
function sizes(a,b){let r=[];for(let i=a;i<=b;i+=2) r.push(i);return r;}

// ===== المخازن =====
let couleurs=[], pants=[], gilets=[], vests=[], shirts=[], belts=[], shoes=[], ties=[], bows=[], broches=[];

// ===== تحميل من التخزين =====
Couleurs = JSON.parse(localStorage.getItem("couleurs")) || [];
pants = JSON.parse(localStorage.getItem("pants")) || [];
gilets = JSON.parse(localStorage.getItem("gilets")) || [];
vests = JSON.parse(localStorage.getItem("vests")) || [];
shirts = JSON.parse(localStorage.getItem("shirts")) || [];
belts = JSON.parse(localStorage.getItem("belts")) || [];
shoes = JSON.parse(localStorage.getItem("shoes")) || [];
ties = JSON.parse(localStorage.getItem("ties")) || [];
bows = JSON.parse(localStorage.getItem("bows")) || [];
broches = JSON.parse(localStorage.getItem("broches")) || [];

// ===== إنشاء المخزون افتراضي إن كان فارغ =====
function initStock(){
 if(couleurs.length==0) for(let i=1;i<=20;i++) couleurs.push({name:"اللون "+i,status:"متوفر"});
 if(pants.length==0) for(let i=1;i<=15;i++) sizes(42,56).forEach(s=>pants.push({name:"سروال "+i,size:s,status:"متوفر"}));
 if(gilets.length==0) for(let i=1;i<=15;i++) sizes(42,56).forEach(s=>gilets.push({name:"جيلي "+i,size:s,status:"متوفر"}));
 if(vests.length==0) for(let i=1;i<=15;i++) sizes(42,56).forEach(s=>vests.push({name:"فاست "+i,size:s,status:"متوفر"}));
 if(shirts.length==0){ let s=["XS","S","M","L","XL","XXL","3XL"]; for(let i=1;i<=3;i++) s.forEach(x=>shirts.push({name:"قميص "+i,size:x,status:"متوفر"})); }
 if(belts.length==0) for(let i=1;i<=3;i++) belts.push({name:"حزام "+i,status:"متوفر"});
 if(shoes.length==0) for(let i=1;i<=15;i++) [39,40,41,42,43,44].forEach(s=>shoes.push({name:"حذاء "+i,size:s,status:"متوفر"}));
 if(ties.length==0) for(let i=1;i<=20;i++) ties.push({name:"ربطة "+i,status:"متوفر"});
 if(bows.length==0) for(let i=1;i<=10;i++) bows.push({name:"فراشة "+i,status:"متوفر"});
 if(broches.length==0) for(let i=1;i<=10;i++) broches.push({name:"بروش "+i,status:"متوفر"});

 // تعريف عالمي للوصول من showStock
 window.couleurs=couleurs; window.pants=pants; window.gilets=gilets; window.vests=vests;
 window.shirts=shirts; window.belts=belts; window.shoes=shoes;
 window.ties=ties; window.bows=bows; window.broches=broches;

 saveAll();
}
initStock();

// ===== حفظ البيانات =====
function saveAll(){
 localStorage.setItem("Couleurs",JSON.stringify(Couleurs));
 localStorage.setItem("pants",JSON.stringify(pants));
 localStorage.setItem("gilets",JSON.stringify(gilets));
 localStorage.setItem("vests",JSON.stringify(vests));
 localStorage.setItem("shirts",JSON.stringify(shirts));
 localStorage.setItem("belts",JSON.stringify(belts));
 localStorage.setItem("shoes",JSON.stringify(shoes));
 localStorage.setItem("ties",JSON.stringify(ties));
 localStorage.setItem("bows",JSON.stringify(bows));
 localStorage.setItem("broches",JSON.stringify(broches));
 localStorage.setItem("rentals",JSON.stringify(rentals));
}

// ===== تعبئة القوائم =====
function fillSelect(id,arr){
 let s=document.getElementById(id);
 s.innerHTML="<option value=''>--اختيار--</option>";
 arr.forEach((x,i)=>{
  let o=document.createElement("option");
  o.value=i;
  o.text = x.name + (x.size?" "+x.size:"") + " ("+x.status+")";
  if(x.status!="متوفر") o.disabled=true;
  s.appendChild(o);
 });
}

function refreshSelects(){
 fillSelect("couleur",Couleurs);
 fillSelect("pant",pants);
 fillSelect("gilet",gilets);
 fillSelect("vest",vests);
 fillSelect("shirt",shirts);
 fillSelect("belt",belts);
 fillSelect("shoe",shoes);
 fillSelect("tie",ties);
 fillSelect("bow",bows);
 fillSelect("broche",broches);
}
refreshSelects();

// ===== حماية من undefined =====
function get(arr,v){
 if(v==="" || !arr[v]) return "";
 return arr[v].name + (arr[v].size?" "+arr[v].size:"");
}

// ===== عرض المؤجرين =====
function renderRentals(list=rentals){
 let t=document.getElementById("rentalsBody");
 t.innerHTML="";
 list.forEach((r,i)=>{
  t.innerHTML+=`
  <tr class="${r.returned?'returned':''}">
   <td>${r.fname}</td>
   <td>${r.phone}</td>
   <td>${get(couleurs,r.couleur)}</td>
   <td>${get(pants,r.pant)}</td>
   <td>${get(gilets,r.gilet)}</td>
   <td>${get(vests,r.vest)}</td>
   <td>${get(shirts,r.shirt)}</td>
   <td>${get(belts,r.belt)}</td>
   <td>${get(shoes,r.shoe)}</td>
   <td>${get(ties,r.tie)}</td>
   <td>${get(bows,r.bow)}</td>
   <td>${get(broches,r.broche)}</td>
   <td>${r.returnDate || "-"}</td>
   <td><button onclick="returnRental(${i})">إرجاع</button></td>
   <td><button onclick="deleteRental(${i})">حذف</button></td>
  </tr>`;
 });
}
renderRentals();

// ===== إضافة تأجير =====
function addRental(){
 let r={
  fname:fname.value,
  phone:phone.value,
  couleur:couleur.value,
  pant:pant.value,
  gilet:gilet.value,
  vest:vest.value,
  shirt:shirt.value,
  belt:belt.value,
  shoe:shoe.value,
  tie:tie.value,
  bow:bow.value,
  broche:broche.value,
  returned:false,
  returnDate: document.getElementById("returnDate").value
 };
 if(r.couleur!=="") couleurs[r.couleur].status="مؤجر";
 if(r.pant!=="") pants[r.pant].status="مؤجر";
 if(r.gilet!=="") gilets[r.gilet].status="مؤجر";
 if(r.vest!=="") vests[r.vest].status="مؤجر";
 if(r.shirt!=="") shirts[r.shirt].status="مؤجر";
 if(r.belt!=="") belts[r.belt].status="مؤجر";
 if(r.shoe!=="") shoes[r.shoe].status="مؤجر";
 if(r.tie!=="") ties[r.tie].status="مؤجر";
 if(r.bow!=="") bows[r.bow].status="مؤجر";
 if(r.broche!=="") broches[r.broche].status="مؤجر";
 rentals.push(r);
 saveAll();
 renderRentals();
 refreshSelects();
}

// ===== زر الإرجاع =====
function returnRental(i){
 let r=rentals[i];
 [couleurs,pants,gilets,vests,shirts,belts,shoes,ties,bows,broches].forEach((arr,idx)=>{
  let k=["couleur","pant","gilet","vest","shirt","belt","shoe","tie","bow","broche"][idx];
  if(r[k]!=="") arr[r[k]].status="متوفر";
 });
 r.returned=true;
 saveAll();
 renderRentals();
 refreshSelects();
}

// ===== زر الحذف مع إرجاع =====
function deleteRental(i){
 let r=rentals[i];
 if(!confirm("حذف المؤجر مع إرجاع القطع؟")) return;
 returnRental(i);
 rentals.splice(i,1);
 saveAll();
 renderRentals();
 refreshSelects();
}

// ===== البحث عن بدلة =====
function searchRental(){
 let val = document.getElementById("searchInput").value.toLowerCase();
 let filtered = rentals.filter(r=>{
   let items = [
     get(couleurs,r.couleur),
     get(pants,r.pant),
     get(gilets,r.gilet),
     get(vests,r.vest),
     get(shirts,r.shirt),
     get(belts,r.belt),
     get(shoes,r.shoe),
     get(ties,r.tie),
     get(bows,r.bow),
     get(broches,r.broche)
   ];
   return items.some(x=>x.toLowerCase().includes(val));
 });
 renderRentals(filtered);
}

// ===== عرض المخزون الخاص =====
function showStock(type){
 let arr = window[type];
 if(!arr) { alert("المخزون غير موجود!"); return; }
 document.getElementById("mainPage").style.display="none";
 document.getElementById("stockPages").style.display="block";
 let tbody = document.getElementById("stockBody");
 tbody.innerHTML="";
 arr.forEach(x=>{
  tbody.innerHTML+=`<tr>
   <td>${x.name}</td>
   <td>${x.size || "-"}</td>
   <td>${x.status}</td>
  </tr>`;
 });
}

function hideStock(){
 document.getElementById("mainPage").style.display="block";
 document.getElementById("stockPages").style.display="none";
}
</script>

</body>
</html>




