<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>SYSTEME COSTUME 17</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCmOcOnLJGmlym4Z__BG6wnb43fQK8JR6ew",
  authDomain: "costume17-79fe2.firebaseapp.com",
  databaseURL: "https://costume17-79fe2-default-rtdb.firebaseio.com",
  projectId: "costume17-79fe2",
  storageBucket: "costume17-79fe2.appspot.com",
  messagingSenderId: "186622774682",
  appId: "1:186622774682:web:f498993ae2c45423a0be23"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<style>
body{font-family:Arial;direction:rtl;background:#f4f4f4;margin:0;}
.container{max-width:1100px;margin:auto;background:#fff;padding:20px;border-radius:8px}
form{display:flex;flex-wrap:wrap;gap:8px}
form input,select{flex:1;padding:6px}
button{background:#3498db;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer}
button:hover{opacity:.8}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{border:1px solid #ccc;padding:5px;text-align:center}
.returned{background:#c8f7c5}
.search-box{margin:10px 0}
</style>
</head>
<body>

<div class="container">
<h2>واجهة التأجير</h2>

<form>
<input id="fname" placeholder="الاسم واللقب">
<input id="phone" placeholder="الهاتف">
<input type="date" id="rentDate">
<input type="date" id="returnDate">

<select id="pant"></select>
<select id="gilet"></select>
<select id="vest"></select>
<select id="shirt"></select>
<select id="belt"></select>
<select id="shoe"></select>
<select id="tie"></select>
<select id="bow"></select>
<select id="broche"></select>

<button type="button" onclick="addRental()">تأكيد التأجير</button>
</form>

<table>
<thead>
<tr>
<th>الاسم واللقب</th>
<th>الهاتف</th>
<th>السروال</th>
<th>الجيلي</th>
<th>الفاست</th>
<th>القميص</th>
<th>الحزام</th>
<th>الحذاء</th>
<th>الربطة</th>
<th>الفراشة</th>
<th>البروش</th>
<th>تاريخ الإرجاع</th>
<th>إرجاع</th>
<th>حذف</th>
</tr>
</thead>
<tbody id="rentalsBody"></tbody>
</table>

</div>

<script>
rentDate.value = new Date().toISOString().split('T')[0];

let pants=[], shirts=[], rentals=[];

// ===== تحميل البيانات =====
db.ref("pants").on("value", s=>{pants=s.val()||[]; fillSelect("pant",pants)});
db.ref("shirts").on("value", s=>{shirts=s.val()||[]; fillSelect("shirt",shirts)});
db.ref("rentals").on("value", s=>{
rentals = s.val()?Object.values(s.val()):[];
renderRentals();
});

// ===== إنشاء المخزون مرة واحدة =====
function initStock(){
if(pants.length===0){
 for(let i=1;i<=15;i++)
  for(let s=42;s<=56;s+=2)
   pants.push({name:"سروال "+i,size:s,status:"متوفر"});
 db.ref("pants").set(pants);
}

if(shirts.length===0){
 ["XS","S","M","L","XL","XXL","3XL"].forEach(size=>{
 shoesLoop:
 shirts.push({name:"قميص",size,status:"متوفر"});
 })
 db.ref("shirts").set(shirts);
}
}
setTimeout(initStock,1500);

// ===== ملء القوائم =====
function fillSelect(id,arr){
 let s=document.getElementById(id);
 s.innerHTML="<option value=''>-- اختيار --</option>";
 arr.forEach((x,i)=>{
  let o=document.createElement("option");
  o.value=i;
  o.text=`${x.name} ${x.size||""} (${x.status})`;
  if(x.status!=="متوفر") o.disabled=true;
  s.appendChild(o);
 });
}

// ===== إضافة تأجير =====
function addRental(){
 let r={
  fname:fname.value,
  phone:phone.value,
  pant:pant.value,
  shirt:shirt.value,
  returnDate:returnDate.value,
  returned:false
 };

 if(r.pant!=="") pants[r.pant].status="مؤجر";
 if(r.shirt!=="") shirts[r.shirt].status="مؤجر";

 db.ref("pants").set(pants);
 db.ref("shirts").set(shirts);
 db.ref("rentals").push(r);
}

// ===== عرض =====
function renderRentals(list=rentals){
 rentalsBody.innerHTML="";
 list.forEach((r,i)=>{
 rentalsBody.innerHTML+=`
 <tr class="${r.returned?"returned":""}">
 <td>${r.fname}</td>
 <td>${r.phone}</td>
 <td>${getItem(pants,r.pant)}</td>
 <td>${getItem(shirts,r.shirt)}</td>
 <td>${r.returnDate||"-"}</td>
 <td><button onclick="returnRental(${i})">إرجاع</button></td>
 <td><button onclick="deleteRental(${i})">حذف</button></td>
 </tr>`;
});
}

// ===== أدوات =====
function getItem(arr,i){return arr[i]?arr[i].name+" "+arr[i].size:"";}

// ===== إرجاع =====
function returnRental(i){
 let r=rentals[i];
 pants[r.pant].status="متوفر";
 shirts[r.shirt].status="متوفر";
 r.returned=true;
 db.ref("pants").set(pants);
 db.ref("shirts").set(shirts);
 db.ref("rentals").set(rentals);
}

// ===== حذف =====
function deleteRental(i){
 rentals.splice(i,1);
 db.ref("rentals").set(rentals);
}

// ===== بحث =====
function searchRental(){
 let v=searchInput.value.toLowerCase();
 let f=rentals.filter(r=>{
  return getItem(pants,r.pant).toLowerCase().includes(v) ||
         getItem(shirts,r.shirt).toLowerCase().includes(v);
 });
 renderRentals(f);
}
</script>

</body>
</html>


