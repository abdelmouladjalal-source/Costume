<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>COSTUME 17 - Firebase</title>
<style>
body{font-family:Arial;direction:rtl;background:#f4f4f4}
.container{max-width:1100px;margin:auto;background:white;padding:20px;border-radius:8px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:5px;text-align:center}
.available{background:#e8ffe8}
.rented{background:#ffd6d6}
select,input,button{padding:6px;margin:2px}
button{background:#3498db;color:white;border:none;border-radius:4px;cursor:pointer}
button:hover{opacity:.8}
</style>
</head>
<body>

<div class="container">
<h2>COSTUME 17</h2>

<form>
<input placeholder="الاسم" id="fname">
<input placeholder="الهاتف" id="phone">
<input type="date" id="returnDate">

<select id="pants"></select>
<select id="gilets"></select>
<select id="vests"></select>
<select id="shirts"></select>
<select id="belts"></select>
<select id="shoes"></select>
<select id="ties"></select>
<select id="bows"></select>
<select id="broches"></select>

<button type="button" onclick="addRental()">تأكيد التأجير</button>
</form>

<br>

<table>
<thead>
<tr>
<th>الاسم</th><th>الهاتف</th>
<th>سروال</th><th>جيلي</th><th>فاست</th><th>قميص</th>
<th>حزام</th><th>حذاء</th><th>ربطة</th><th>فراشة</th><th>بروش</th>
<th>إرجاع</th>
</tr>
</thead>
<tbody id="rentals"></tbody>
</table>

</div>
<div class="stock-buttons">
<button onclick="location.href='pants.html'">مخزن السراويل</button>
<button onclick="location.href='gilets.html'">مخزن الجيلي</button>
<button onclick="location.href='vests.html'">مخزن الفاست</button>
<button onclick="location.href='shoes.html'">مخزن الأحذية</button>
<button onclick="location.href='shirts.html'">مخزن القمصان</button>
<button onclick="location.href='ties.html'">مخزن ربطات العنق</button>
<button onclick="location.href='bows.html'">مخزن الفراشات</button>
<button onclick="location.href='broches.html'">مخزن البروش</button>
<button onclick="location.href='belts.html'">مخزن الأحزمة</button>
</div>

<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCmOcOnLJGlym4Z__BG6wnb43fQK8JR6ew",
  authDomain: "costume17-79fe2.firebaseapp.com",
  projectId: "costume17-79fe2",
  storageBucket: "costume17-79fe2.firebasestorage.app",
  messagingSenderId: "186622774682",
  appId: "1:186622774682:web:f498993ae2c45423a0be23"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ✅ المخازن
const stocks = ["pants","gilets","vests","shirts","belts","shoes","ties","bows","broches"];

// ✅ تحميل القوائم
async function loadStock(type){
 let select = document.getElementById(type);
 select.innerHTML = "<option value=''>--اختيار--</option>";
 let snap = await getDocs(collection(db,type));
 snap.forEach(doc=>{
   let item = doc.data();
   let opt = document.createElement("option");
   opt.value = doc.id;
   opt.innerText = item.name + (item.size ? " " + item.size : "") + " ("+item.status+")";
   if(item.status!="متوفر") opt.disabled = true;
   select.appendChild(opt);
 });
}

stocks.forEach(loadStock);

// ✅ إضافة تأجير
async function addRental(){
 let data = {
   fname: fname.value,
   phone: phone.value,
   returnDate: returnDate.value,
 };

 for(let s of stocks){
   data[s] = document.getElementById(s).value;
   if(data[s]){
     let ref = doc(db,s,data[s]);
     await updateDoc(ref,{status:"مؤجر"});
   }
 }

 await addDoc(collection(db,"rentals"),data);
 alert("تم التأجير ✅");
 location.reload();
}

// ✅ عرض المؤجرين
async function loadRentals(){
 let body = document.getElementById("rentals");
 body.innerHTML="";
 let snap = await getDocs(collection(db,"rentals"));
 snap.forEach(d=>{
   let r = d.data();
   body.innerHTML+=`
   <tr>
   <td>${r.fname}</td>
   <td>${r.phone}</td>
   <td>${r.pants||""}</td>
   <td>${r.gilets||""}</td>
   <td>${r.vests||""}</td>
   <td>${r.shirts||""}</td>
   <td>${r.belts||""}</td>
   <td>${r.shoes||""}</td>
   <td>${r.ties||""}</td>
   <td>${r.bows||""}</td>
   <td>${r.broches||""}</td>
   <td>${r.returnDate||""}</td>
   </tr>
   `;
 });
}

loadRentals();

</script>

</body>
</html>

